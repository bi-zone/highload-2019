# Задание на scala

## Легенда

Есть система, в которую входят пользователи. Для каждого входа записывается
время, IP адрес и login пользователя.

Хочется анализировать подозрительную активность по входам в систему. Решено, что
подозрительным будет вход большого количества пользователей с одного IP за
некоторое время.

Ваша задача сделать сервис, который эту активность определяет.

## События

События поступают
[по websocket в виде текстовых data frame'ов](https://tools.ietf.org/html/rfc6455#section-5.6).
Сообщение состоит из трёх полей разделенных пробелом. Пример сообщения в
websocket:

```
1547339769 boomorah 168.72.31.248
```

где поля

* timestamp – unit time в секундах
* login – строка, состоит только из символов a-z
* IP адрес

## Логика подсчёта

Обработка разбита на временные окна. Время начала первого окна и размер окна в
секундах заданы в данных по задаче. Начало окна включается в него, конец не
включается.

Необходимо найти IP адрес с которого поступило наибольшее количество уникальных
login за временное окно. Если есть несколько IP адресов, для которых количество
уникальных login за окно одинаково, необходимо лексикографически отсортировать
эти IP адреса и взять самый младший.

Полученные для всех окон IP адреса необходимо преобразовать в UTF-8, объединить
в одну строку (без разделителя) и посчитать от строки SHA1 хэш. Этот хэш и будет
ответом на задание.

## Пример подсчёта

Пусть размер окна 10 секунд, начальный timestamp 1546300000 и пришли следующие
события:

1-е окно:

```
1546300000 bob 231.70.214.227
1546300002 alice 231.70.214.227
1546300002 frank 219.223.7.83
1546300009 alice 231.70.214.227
```

2-е окно:

```
1546300010 mary 181.106.169.128
1546300011 mary 231.70.214.227
1546300012 mary 234.146.138.220
1546300013 misgiven 182.18.81.139
1546300016 camouflager 219.223.7.83
1546300018 labyrinth 219.223.7.83
1546300019 newburg 182.18.81.139
```

В первом окне выбираем `231.70.214.227`: так как с этого IP адреса было два
входа – `alice` и `bob`.

Во втором было по два разных login c `219.223.7.83` и `182.18.81.139`. После
лексикографической сортировки выбираем `182.18.81.139`. Обратите внимание, входы
с логином `mary` здесь не рассматриваются, так как все они были с разных IP
адресов.

Полученные в двух окнах IP адреса объединяем и считаем по ним ответ:

```
sha1("231.70.214.227182.18.81.139") = 140bf7f921ed93c57bdc870814b0db9125cfab56
```

## Websocket клиент

К заданию приложен jar файл. Для его запуска требуется java 8:

```
java -jar ws-client.jar ws-uri seed size
```


где в `seed` и `size` впишите данные по заданию, а в `ws-uri` укажите адрес
websocket сервера (без SSL). Например:

```
java -jar ws-client.jar ws://localhost:8080/process 100500 10000
```

После запуска клиент откроет websocket соединение и передаст в него `size`
событий.


## Условия

Для самопроверки в задании доступны решения для 3000 и 10000 событий. Чтобы
посчитать ответ на задачу, нужно будет обработать 10 000 000 событий (10 млн).

Результат необходимо сделать на scala.

Выбор framework и решений остаётся на ваше усмотрение. Если не знаете с чего
начать, попробуйте
[akka-http](https://doc.akka.io/docs/akka-http/current/server-side/websocket-support.html).


## Есть вопросы?

Приходите в наш telegram чат (**TODO:** тут ссылка на чат).

## Данные для задачи

```
seed: 100506
размер окна: 2100 секунд
отсчёт окон ведётся с 1547510400
ответ для size=3000: db9714b3100a2be9795df2264f31df8e9fe774d5
ответ для size=10000: 04b949d8ec4248ef1f803c6029d531cce8a137d3
```
