# Задание на scala

## Легенда

Есть система, в которую входят пользователи. Для каждого входа записывается
время, IP адрес и login пользователя.

Хочется анализировать подозрительную активность по входам в систему. Решено, что
подозрительным будет вход большого количества пользователей с одного IP за
некоторое время.

## Задача

Ваша задача сделать сервис, который эту активность определяет.

Вам нужно реализовать TCP сервер, принимающий события и подсчитывающий ответ.
TCP клиент для передачи событий прилагается. Решение должно быть на scala.

Выбор framework и решений остаётся на ваше усмотрение. Если не знаете с чего
начать, возьмите заготовку
[решения на akka и akka streams (`solution-template/`)](solution-template/)
из этого репозитория.

## События

События поступают через TCP соединение, в которое записываются строки в UTF-8.
Сообщение состоит из трёх полей разделенных пробелом. Пример сообщения:

```
1547339769 boomorah 168.72.31.248
```

где поля

* timestamp – unit time в секундах
* login – строка, состоит только из символов a-z
* IP адрес

Когда все события поступили, отправляется пустая строка и TCP соединение
закрывается.

## Логика подсчёта

Обработку нужно разбить на временные окна по 2100 секунд. Окна отсчитываются от
timestamp `1547510400`. Начало окна включается в него, конец не включается.

Необходимо найти IP адрес с которого поступило наибольшее количество уникальных
login за каждое временное окно. Если есть несколько IP адресов, для которых
количество уникальных login за окно одинаково, необходимо лексикографически
отсортировать эти IP адреса и взять самый младший.

Полученные для всех окон IP адреса необходимо преобразовать в UTF-8, объединить
в одну строку (без разделителя) и посчитать от строки SHA1 хэш. Этот хэш и будет
ответом на задание.

Для получения ответа вам необходимо будет обработать 3 000 000 (3 млн) событий.

Для проверки решения на меньших объёмах:

* для size=3000: db9714b3100a2be9795df2264f31df8e9fe774d5
* для size=10000: 04b949d8ec4248ef1f803c6029d531cce8a137d3
* для size=300000: 90de05bb98cff656e06b1fd330fe87511d26623d

## Пример подсчёта

Пусть размер окна 10 секунд, начальный timestamp 1546300000 и пришли следующие
события:

1-е окно:

```
1546300000 bob 231.70.214.227
1546300002 alice 231.70.214.227
1546300002 frank 219.223.7.83
1546300009 alice 231.70.214.227
```

2-е окно:

```
1546300010 mary 181.106.169.128
1546300011 mary 231.70.214.227
1546300012 mary 234.146.138.220
1546300013 misgiven 182.18.81.139
1546300016 camouflager 219.223.7.83
1546300018 labyrinth 219.223.7.83
1546300019 newburg 182.18.81.139
```

В первом окне выбираем `231.70.214.227`: так как с этого IP адреса было два
входа – `alice` и `bob`.

Во втором было по два разных login c `219.223.7.83` и `182.18.81.139`. После
лексикографической сортировки выбираем `182.18.81.139`. Обратите внимание, входы
с логином `mary` здесь не рассматриваются, так как все они были с разных IP
адресов.

Полученные в двух окнах IP адреса объединяем и считаем по ним ответ:

```
sha1("231.70.214.227182.18.81.139") = 140bf7f921ed93c57bdc870814b0db9125cfab56
```

## TCP клиент

К заданию приложен jar файл. Для его запуска требуется java 8:

```
java -jar tcp-client.jar host port 100506 size
```

где в `size` впишите нужное количество событий, а в `host` и `port` укажите
адрес и порт TCP сервера, который вы реализуете. Например:

```
java -jar tcp-client.jar 127.0.0.1 7777 100506 3000000
```

После запуска клиент откроет TCP соединение и передаст в него `size`
событий.


## Есть вопросы?

Приходите в наш telegram чат (**TODO:** тут ссылка на чат).
